function triggerGacha(childId) {
        console.log("ðŸŽ¯ Gacha button clicked for child:", childId);
        const panel = event.target.closest('.js-tab-panel1');
        const taskResults = collectTaskResults(panel);
        console.log("ðŸ“Š Task results:", taskResults);

        // Livewireã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚¬ãƒãƒ£é–‹å§‹ã‚’é€šçŸ¥
        console.log("ðŸ”— Dispatching openGachaModal event");
        Livewire.dispatch('openGachaModal', [childId, taskResults.trueCount, taskResults.totalTasks]);
    }

    function collectTaskResults(panel) {
        const judgeWrappers = panel.querySelectorAll('.js-judge-wrapper');
        let trueCount = 0;
        let totalTasks = judgeWrappers.length;

        judgeWrappers.forEach(wrapper => {
            const trueSpan = wrapper.querySelector('[data-result="true"]');
            if (trueSpan && !trueSpan.classList.contains('hidden')) {
                trueCount++;
            }
        });

        return { trueCount, totalTasks };
    }